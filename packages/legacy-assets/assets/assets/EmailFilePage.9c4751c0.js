import{f as te,x as W,h as _,q as x,t as D,a7 as N,a4 as j,j as F,X as _e,n as Se,k as ae,R as Te,_ as $e,a as Pe,o as u,aa as p,e as s,w as n,W as Be,J as $,G as w,ab as z,c as q,I as U,F as d,H as v,Q as R,aC as Ce}from"./index.7b40bbd4.js";import{y as qe,u as He,v as V,h as Ee,a as Fe,i as Me,b as Ae,j as Qe,k as Ie,d as Oe,l as Le,r as G,s as We,c as J,p as X,n as xe,f as K,w as Y,x as De,e as b,Q as Ne}from"./QSeparator.83243ffb.js";import{u as H,a as je}from"./use-transition.d5ce3370.js";import{s as ze,g as Ue}from"./scroll.729e661d.js";import{a as Z,Q as P}from"./QCard.6072a0ad.js";import{Q as ee}from"./QCardActions.b2294be0.js";import"./axios.c4f749e1.js";import{u as Re}from"./use-quasar.e078d8d3.js";import{u as Ve}from"./main-store.718cb995.js";import"./focus-manager.1ddae684.js";import"./use-dark.5b3707da.js";var E=te({name:"QTooltip",inheritAttrs:!1,props:{...qe,...He,...H,maxHeight:{type:String,default:null},maxWidth:{type:String,default:null},transitionShow:{...H.transitionShow,default:"jump-down"},transitionHide:{...H.transitionHide,default:"jump-up"},anchor:{type:String,default:"bottom middle",validator:V},self:{type:String,default:"top middle",validator:V},offset:{type:Array,default:()=>[14,14],validator:Ee},scrollTarget:ze,delay:{type:Number,default:0},hideDelay:{type:Number,default:0},persistent:Boolean},emits:[...Fe],setup(e,{slots:t,emit:f,attrs:o}){let a,l;const r=Se(),{proxy:{$q:c}}=r,g=W(null),S=W(!1),se=_(()=>X(e.anchor,c.lang.rtl)),oe=_(()=>X(e.self,c.lang.rtl)),le=_(()=>e.persistent!==!0),{registerTick:ne,removeTick:ie}=Me(),{registerTimeout:T}=Ae(),{transitionProps:re,transitionStyle:de}=je(e),{localScrollTarget:M,changeScrollEvent:ce,unconfigureScrollTarget:ue}=Qe(e,O),{anchorEl:m,canShow:me,anchorEvents:k}=Ie({showing:S,configureAnchorEl:ye}),{show:fe,hide:B}=Oe({showing:S,canShow:me,handleShow:pe,handleHide:ve,hideOnRouteChange:le,processOnMount:!0});Object.assign(k,{delayShow:ge,delayHide:ke});const{showPortal:A,hidePortal:Q,renderPortal:he}=Le(r,g,be,"tooltip");if(c.platform.is.mobile===!0){const i={anchorEl:m,innerRef:g,onClickOutside(h){return B(h),h.target.classList.contains("q-dialog__backdrop")&&Te(h),!0}},C=_(()=>e.modelValue===null&&e.persistent!==!0&&S.value===!0);x(C,h=>{(h===!0?xe:G)(i)}),D(()=>{G(i)})}function pe(i){A(),ne(()=>{l=new MutationObserver(()=>y()),l.observe(g.value,{attributes:!1,childList:!0,characterData:!0,subtree:!0}),y(),O()}),a===void 0&&(a=x(()=>c.screen.width+"|"+c.screen.height+"|"+e.self+"|"+e.anchor+"|"+c.lang.rtl,y)),T(()=>{A(!0),f("show",i)},e.transitionDuration)}function ve(i){ie(),Q(),I(),T(()=>{Q(!0),f("hide",i)},e.transitionDuration)}function I(){l!==void 0&&(l.disconnect(),l=void 0),a!==void 0&&(a(),a=void 0),ue(),N(k,"tooltipTemp")}function y(){We({targetEl:g.value,offset:e.offset,anchorEl:m.value,anchorOrigin:se.value,selfOrigin:oe.value,maxHeight:e.maxHeight,maxWidth:e.maxWidth})}function ge(i){if(c.platform.is.mobile===!0){J(),document.body.classList.add("non-selectable");const C=m.value,h=["touchmove","touchcancel","touchend","click"].map(L=>[C,L,"delayHide","passiveCapture"]);j(k,"tooltipTemp",h)}T(()=>{fe(i)},e.delay)}function ke(i){c.platform.is.mobile===!0&&(N(k,"tooltipTemp"),J(),setTimeout(()=>{document.body.classList.remove("non-selectable")},10)),T(()=>{B(i)},e.hideDelay)}function ye(){if(e.noParentEvent===!0||m.value===null)return;const i=c.platform.is.mobile===!0?[[m.value,"touchstart","delayShow","passive"]]:[[m.value,"mouseenter","delayShow","passive"],[m.value,"mouseleave","delayHide","passive"]];j(k,"anchor",i)}function O(){if(m.value!==null||e.scrollTarget!==void 0){M.value=Ue(m.value,e.scrollTarget);const i=e.noParentEvent===!0?y:B;ce(M.value,i)}}function we(){return S.value===!0?F("div",{...o,ref:g,class:["q-tooltip q-tooltip--style q-position-engine no-pointer-events",o.class],style:[o.style,de.value],role:"tooltip"},ae(t.default)):null}function be(){return F(_e,re.value,we)}return D(I),Object.assign(r.proxy,{updatePosition:y}),he}}),Ge=te({name:"QBtnGroup",props:{unelevated:Boolean,outline:Boolean,flat:Boolean,rounded:Boolean,square:Boolean,push:Boolean,stretch:Boolean,glossy:Boolean,spread:Boolean},setup(e,{slots:t}){const f=_(()=>{const o=["unelevated","outline","flat","rounded","square","push","stretch","glossy"].filter(a=>e[a]===!0).map(a=>`q-btn-group--${a}`).join(" ");return`q-btn-group row no-wrap${o.length!==0?" "+o:""}`+(e.spread===!0?" q-btn-group--spread":" inline")});return()=>F("div",{class:f.value},ae(t.default))}});const Je=Pe({name:"EmailFolderPage",data:()=>({srcdoc:null,file:null,fileHead:null,timeInterval:null,attachments:[]}),computed:{selectedBucket:function(){return this.$route.params.bucket},selectedFolder:function(){return this.$route.params.folder},selectedFile:function(){return this.$route.params.file},filePath:function(){const e=K(this.selectedFile);return`.r2-explorer/emails/${this.selectedFolder}/${e}`}},watch:{selectedBucket(e){this.$router.push({name:"email-folder",params:{bucket:e,folder:Y(this.selectedFolder)}})}},methods:{timeSince:De,contentFinishedLoading(){clearInterval(this.timeInterval),this.timeInterval=null,this.resizeIframe()},resizeIframe(){this.$refs.renderWindow&&(this.$refs.renderWindow.style.height=`${this.$refs.renderWindow.contentWindow.document.documentElement.scrollHeight}px`)},fetchEmail:async function(){const e=K(this.selectedFile),t=await b.downloadFile(this.selectedBucket,this.filePath,{}),f=e.split(".json")[0];this.file=t.data;let o=t.data.html;if(o){o=o.replaceAll(/<a(.*?)>(.*?)<\/a>/gi,'<a$1 target="_blank">$2</a>');for(const a of t.data.attachments){a.display=!0,a.downloadUrl=`${this.mainStore.serverUrl}/api/buckets/${this.selectedBucket}/${Y(`.r2-explorer/emails/${this.selectedFolder}/${f}/${a.filename}`)}`;let l=a.contentId;if(l){l.startsWith("<")&&l.endsWith(">")&&(l=l.substring(1,l.length-1));const r=`cid:${l}`;o.includes(r)&&(o=o.replaceAll(`cid:${l}`,a.downloadUrl),a.display=!1)}}this.srcdoc=o}this.attachments=t.data.attachments.filter(a=>a.display),b.headFile(this.selectedBucket,this.filePath).then(async a=>{a.customMetadata.read==="false"?this.fileHead=await b.updateMetadata(this.selectedBucket,this.filePath,{...a.customMetadata,read:!0}):this.fileHead=a}),setTimeout(()=>{this.contentFinishedLoading()},1e4),this.timeInterval=setInterval(()=>{this.resizeIframe()},400)},markAsUnread:async function(){this.fileHead=await b.updateMetadata(this.selectedBucket,this.filePath,{...this.fileHead.customMetadata,read:!1}),this.q.notify({group:!1,icon:"done",spinner:!1,message:"Email marked as unread!",timeout:2500})},markAsRead:async function(){this.fileHead=await b.updateMetadata(this.selectedBucket,this.filePath,{...this.fileHead.customMetadata,read:!0}),this.q.notify({group:!1,icon:"done",spinner:!1,message:"Email marked as read!",timeout:2500})},downloadAtt:e=>{console.log(e);const t=document.createElement("a");t.download=e.filename,t.href=e.downloadUrl,document.body.appendChild(t),t.click(),document.body.removeChild(t)}},created(){this.fetchEmail()},setup(){return{mainStore:Ve(),q:Re()}}}),Xe={key:0},Ke={class:"font-18 q-my-none"},Ye={class:"d-flex row"},Ze={class:"d-flex column"},et={class:"text-muted"},tt={class:"q-ml-auto"},at={class:""},st={class:"overflow-auto d-block email-wrapper"},ot=["srcdoc"],lt=["innerHTML"],nt={class:"row attachments"},it={key:1,class:"text-center q-my-lg"};function rt(e,t,f,o,a,l){return this.file?(u(),p("div",Xe,[s(Z,null,{default:n(()=>[s(P,{class:"bg-grey-2 text-black",vertical:""},{default:n(()=>[s(Ge,{unelevated:""},{default:n(()=>[s($,{push:"",icon:"arrow_back",to:{name:"email-folder",params:{bucket:e.$route.params.bucket,folder:e.$route.params.folder}}},{default:n(()=>[s(E,null,{default:n(()=>t[1]||(t[1]=[w("Back")])),_:1})]),_:1},8,["to"]),e.fileHead?(u(),p(z,{key:0},[e.fileHead.customMetadata.read==="true"?(u(),q($,{key:0,push:"",icon:"mark_email_unread",onClick:e.markAsUnread},{default:n(()=>[s(E,null,{default:n(()=>t[2]||(t[2]=[w("Mark email as unread")])),_:1})]),_:1},8,["onClick"])):(u(),q($,{key:1,push:"",icon:"mark_email_read",onClick:e.markAsRead},{default:n(()=>[s(E,null,{default:n(()=>t[3]||(t[3]=[w("Mark email as read")])),_:1})]),_:1},8,["onClick"]))],64)):U("",!0)]),_:1})]),_:1}),s(P,{vertical:""},{default:n(()=>[d("h5",Ke,v(e.file.subject),1)]),_:1}),s(P,{horizontal:"",class:"q-px-sm"},{default:n(()=>[d("div",Ye,[s(R,{name:"account_circle",size:"xl",class:"q-mr-sm"}),d("div",Ze,[d("span",null,[w(v(e.file.from.name)+" ",1),d("small",et,"<"+v(e.file.from.address)+">",1)]),d("span",null,"to "+v(e.file.to[0].address),1)])]),d("div",tt,[d("small",at,v(e.file.date)+" ("+v(e.timeSince(new Date(e.file.date)))+")",1)])]),_:1}),s(ee,{vertical:""},{default:n(()=>[d("div",st,[e.srcdoc?(u(),p("iframe",{key:0,frameborder:"0",scrolling:"no",class:"w-100 d-block",onLoad:t[0]||(t[0]=(...r)=>e.contentFinishedLoading&&e.contentFinishedLoading(...r)),ref:"renderWindow",id:"renderWindow",srcdoc:e.srcdoc,sandbox:"allow-popups allow-popups-to-escape-sandbox allow-same-origin",csp:"script-src 'none'"},null,40,ot)):(u(),p("div",{key:1,innerHTML:e.file.text.replaceAll(`
`,"<br>")},null,8,lt))])]),_:1}),e.attachments.length>0?(u(),q(ee,{key:0,vertical:""},{default:n(()=>[s(Ne),t[4]||(t[4]=d("h6",{class:"q-my-md"},"Attachments",-1)),d("div",nt,[(u(!0),p(z,null,Ce(e.file.attachments,r=>(u(),p("div",{class:"col-md-4 col-sm-12",key:r.filename},[s(Z,null,{default:n(()=>[s(P,{class:"q-pa-sm flex",style:{"align-items":"center"}},{default:n(()=>[s(R,{name:"description",size:"md",color:"blue",class:"q-mr-sm"}),w(" "+v(r.filename)+" ",1),s($,{color:"white","text-color":"black",icon:"download",class:"q-mr-0 q-ml-auto",onClick:c=>e.downloadAtt(r)},null,8,["onClick"])]),_:2},1024)]),_:2},1024)]))),128))])]),_:1})):U("",!0)]),_:1})])):(u(),p("div",it,[s(Be,{color:"primary",size:"3em"})]))}var wt=$e(Je,[["render",rt],["__scopeId","data-v-59368c26"]]);export{wt as default};
